(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{CALL_TO_ACTION_STORE:()=>c,DispatchStatus:()=>ue,LICENSE_STORE:()=>Je,NOTICE_CONTEXT:()=>d,POPUP_STORE:()=>Vt,SETTINGS_STORE:()=>Br,URL_SEARCH_STORE:()=>ma,appendUrlParams:()=>Ie,callToActionStore:()=>Qe,defaultCtaValues:()=>S,defaultLicenseValues:()=>ze,defaultPopupValues:()=>Kt,defaultSettings:()=>zr,fetchFromApi:()=>Re,fetchFromWPApi:()=>he,getErrorMessage:()=>me,licenseStore:()=>kt,popupStore:()=>Qr,restApiUrl:()=>ge,restBase:()=>Se,restUrl:()=>_e,settingsStore:()=>Ia,urlSearchStore:()=>Va,useLicense:()=>ja,useSettings:()=>Fa,validateCallToAction:()=>fe,validatePopup:()=>ir});var r={};e.r(r),e.d(r,{JsonPatchError:()=>K,_areEquals:()=>ee,applyOperation:()=>B,applyPatch:()=>W,applyReducer:()=>X,deepClone:()=>q,getValueByPointer:()=>J,validate:()=>Z,validator:()=>z});var a={};e.r(a),e.d(a,{compare:()=>ce,generate:()=>ie,observe:()=>oe,unobserve:()=>se});var s={};e.r(s),e.d(s,{activateLicense:()=>Rt,activatePro:()=>At,changeActionStatus:()=>ht,checkLicenseStatus:()=>mt,deactivateLicense:()=>It,hydrate:()=>Tt,removeLicense:()=>vt,updateLicenseKey:()=>ft});var o={};e.r(o),e.d(o,{getLicenseData:()=>Ot,getLicenseKey:()=>Nt,getLicenseStatus:()=>Ct});var i={};e.r(i),e.d(i,{getConnectInfo:()=>Ht,getDispatchError:()=>xt,getDispatchStatus:()=>Lt,getLicenseData:()=>Dt,getLicenseKey:()=>wt,getLicenseStatus:()=>bt,hasDispatched:()=>Pt,isDispatching:()=>Ut});const n=window.wp.data,c="popup-maker/call-to-actions",d="pum-cta-editor",l="RECEIVE_RECORD",p="RECEIVE_RECORDS",u="RECEIVE_ERROR",E={RECEIVE_RECORD:l,RECEIVE_RECORDS:p,RECEIVE_QUERY_RECORDS:"RECEIVE_QUERY_RECORDS",RECEIVE_ERROR:u,PURGE_RECORD:"PURGE_RECORD",PURGE_RECORDS:"PURGE_RECORDS",EDITOR_CHANGE_ID:"EDITOR_CHANGE_ID",EDIT_RECORD:"EDIT_RECORD",START_EDITING_RECORD:"START_EDITING_RECORD",SAVE_EDITED_RECORD:"SAVE_EDITED_RECORD",UNDO_EDIT_RECORD:"UNDO_EDIT_RECORD",REDO_EDIT_RECORD:"REDO_EDIT_RECORD",RESET_EDIT_RECORD:"RESET_EDIT_RECORD",CHANGE_ACTION_STATUS:"CHANGE_ACTION_STATUS",START_RESOLUTION:"START_RESOLUTION",FINISH_RESOLUTION:"FINISH_RESOLUTION",FAIL_RESOLUTION:"FAIL_RESOLUTION",INVALIDATE_RESOLUTION:"INVALIDATE_RESOLUTION"},y={byId:{},allIds:[],queries:{},editorId:void 0,editedEntities:{},editHistory:{},editHistoryIndex:{},resolutionState:{},notices:{},errors:{global:null,byId:{}}},S={id:0,uuid:"",slug:"",title:"",content:"",excerpt:"",status:"draft",settings:{type:"link",url:""},date:null,date_gmt:null,guid:"",link:"",modified:"",modified_gmt:"",type:"pum_cta",author:0,generated_slug:"",permalink_template:"",password:"",featured_media:0,comment_status:"open",ping_status:"open",format:"standard",meta:{},sticky:!1,template:"",categories:[],tags:[]},{RECEIVE_RECORD:g,RECEIVE_RECORDS:_,RECEIVE_QUERY_RECORDS:h,RECEIVE_ERROR:R,PURGE_RECORD:I,PURGE_RECORDS:m,EDITOR_CHANGE_ID:f,EDIT_RECORD:v,START_EDITING_RECORD:A,SAVE_EDITED_RECORD:T,UNDO_EDIT_RECORD:O,REDO_EDIT_RECORD:N,RESET_EDIT_RECORD:C,CHANGE_ACTION_STATUS:D,INVALIDATE_RESOLUTION:w}=E,b=window.lodash;var H,L=(H=function(e,t){return H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},H(e,t)},function(e,t){function __(){this.constructor=e}H(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}),U=Object.prototype.hasOwnProperty;function P(e,t){return U.call(e,t)}function x(e){if(Array.isArray(e)){for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(e);var a=[];for(var s in e)P(e,s)&&a.push(s);return a}function k(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function V(e){for(var t,r=0,a=e.length;r<a;){if(!((t=e.charCodeAt(r))>=48&&t<=57))return!1;r++}return!0}function G(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function j(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function F(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(var t=0,r=e.length;t<r;t++)if(F(e[t]))return!0}else if("object"==typeof e)for(var a=x(e),s=a.length,o=0;o<s;o++)if(F(e[a[o]]))return!0;return!1}function M(e,t){var r=[e];for(var a in t){var s="object"==typeof t[a]?JSON.stringify(t[a],null,2):t[a];void 0!==s&&r.push(a+": "+s)}return r.join("\n")}var $=function(e){function t(t,r,a,s,o){var i=this.constructor,n=e.call(this,M(t,{name:r,index:a,operation:s,tree:o}))||this;return n.name=r,n.index=a,n.operation=s,n.tree=o,Object.setPrototypeOf(n,i.prototype),n.message=M(t,{name:r,index:a,operation:s,tree:o}),n}return L(t,e),t}(Error),K=$,q=k,Y={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var a=e[t];return delete e[t],{newDocument:r,removed:a}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:function(e,t,r){var a=J(r,this.path);a&&(a=k(a));var s=B(r,{op:"remove",path:this.from}).removed;return B(r,{op:"add",path:this.path,value:s}),{newDocument:r,removed:a}},copy:function(e,t,r){var a=J(r,this.from);return B(r,{op:"add",path:this.path,value:k(a)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:ee(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}},Q={add:function(e,t,r){return V(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:Y.move,copy:Y.copy,test:Y.test,_get:Y._get};function J(e,t){if(""==t)return e;var r={op:"_get",path:t};return B(e,r),r.value}function B(e,t,r,a,s,o){if(void 0===r&&(r=!1),void 0===a&&(a=!0),void 0===s&&(s=!0),void 0===o&&(o=0),r&&("function"==typeof r?r(t,0,e,t.path):z(t,0)),""===t.path){var i={newDocument:e};if("add"===t.op)return i.newDocument=t.value,i;if("replace"===t.op)return i.newDocument=t.value,i.removed=e,i;if("move"===t.op||"copy"===t.op)return i.newDocument=J(e,t.from),"move"===t.op&&(i.removed=e),i;if("test"===t.op){if(i.test=ee(e,t.value),!1===i.test)throw new K("Test operation failed","TEST_OPERATION_FAILED",o,t,e);return i.newDocument=e,i}if("remove"===t.op)return i.removed=e,i.newDocument=null,i;if("_get"===t.op)return t.value=e,i;if(r)throw new K("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,t,e);return i}a||(e=k(e));var n=(t.path||"").split("/"),c=e,d=1,l=n.length,p=void 0,u=void 0,E=void 0;for(E="function"==typeof r?r:z;;){if((u=n[d])&&-1!=u.indexOf("~")&&(u=j(u)),s&&("__proto__"==u||"prototype"==u&&d>0&&"constructor"==n[d-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===p&&(void 0===c[u]?p=n.slice(0,d).join("/"):d==l-1&&(p=t.path),void 0!==p&&E(t,0,e,p)),d++,Array.isArray(c)){if("-"===u)u=c.length;else{if(r&&!V(u))throw new K("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,t,e);V(u)&&(u=~~u)}if(d>=l){if(r&&"add"===t.op&&u>c.length)throw new K("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,t,e);if(!1===(i=Q[t.op].call(t,c,u,e)).test)throw new K("Test operation failed","TEST_OPERATION_FAILED",o,t,e);return i}}else if(d>=l){if(!1===(i=Y[t.op].call(t,c,u,e)).test)throw new K("Test operation failed","TEST_OPERATION_FAILED",o,t,e);return i}if(c=c[u],r&&d<l&&(!c||"object"!=typeof c))throw new K("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",o,t,e)}}function W(e,t,r,a,s){if(void 0===a&&(a=!0),void 0===s&&(s=!0),r&&!Array.isArray(t))throw new K("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");a||(e=k(e));for(var o=new Array(t.length),i=0,n=t.length;i<n;i++)o[i]=B(e,t[i],r,!0,s,i),e=o[i].newDocument;return o.newDocument=e,o}function X(e,t,r){var a=B(e,t);if(!1===a.test)throw new K("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return a.newDocument}function z(e,t,r,a){if("object"!=typeof e||null===e||Array.isArray(e))throw new K("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(!Y[e.op])throw new K("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r);if("string"!=typeof e.path)throw new K("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new K('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new K("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new K("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&F(e.value))throw new K("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);if(r)if("add"==e.op){var s=e.path.split("/").length,o=a.split("/").length;if(s!==o+1&&s!==o)throw new K("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==a)throw new K("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var i=Z([{op:"_get",path:e.from,value:void 0}],r);if(i&&"OPERATION_PATH_UNRESOLVABLE"===i.name)throw new K("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}function Z(e,t,r){try{if(!Array.isArray(e))throw new K("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)W(k(t),k(e),r||!0);else{r=r||z;for(var a=0;a<e.length;a++)r(e[a],a,t,void 0)}}catch(e){if(e instanceof K)return e;throw e}}function ee(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,a,s,o=Array.isArray(e),i=Array.isArray(t);if(o&&i){if((a=e.length)!=t.length)return!1;for(r=a;0!==r--;)if(!ee(e[r],t[r]))return!1;return!0}if(o!=i)return!1;var n=Object.keys(e);if((a=n.length)!==Object.keys(t).length)return!1;for(r=a;0!==r--;)if(!t.hasOwnProperty(n[r]))return!1;for(r=a;0!==r--;)if(!ee(e[s=n[r]],t[s]))return!1;return!0}return e!=e&&t!=t}var te=new WeakMap,re=function(e){this.observers=new Map,this.obj=e},ae=function(e,t){this.callback=e,this.observer=t};function se(e,t){t.unobserve()}function oe(e,t){var r,a=function(e){return te.get(e)}(e);if(a){var s=function(e,t){return e.observers.get(t)}(a,t);r=s&&s.observer}else a=new re(e),te.set(e,a);if(r)return r;if(r={},a.value=k(e),t){r.callback=t,r.next=null;var o=function(){ie(r)},i=function(){clearTimeout(r.next),r.next=setTimeout(o)};"undefined"!=typeof window&&(window.addEventListener("mouseup",i),window.addEventListener("keyup",i),window.addEventListener("mousedown",i),window.addEventListener("keydown",i),window.addEventListener("change",i))}return r.patches=[],r.object=e,r.unobserve=function(){ie(r),clearTimeout(r.next),function(e,t){e.observers.delete(t.callback)}(a,r),"undefined"!=typeof window&&(window.removeEventListener("mouseup",i),window.removeEventListener("keyup",i),window.removeEventListener("mousedown",i),window.removeEventListener("keydown",i),window.removeEventListener("change",i))},a.observers.set(t,new ae(t,r)),r}function ie(e,t){void 0===t&&(t=!1);var r=te.get(e.object);ne(r.value,e.object,e.patches,"",t),e.patches.length&&W(r.value,e.patches);var a=e.patches;return a.length>0&&(e.patches=[],e.callback&&e.callback(a)),a}function ne(e,t,r,a,s){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var o=x(t),i=x(e),n=!1,c=i.length-1;c>=0;c--){var d=e[p=i[c]];if(!P(t,p)||void 0===t[p]&&void 0!==d&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(s&&r.push({op:"test",path:a+"/"+G(p),value:k(d)}),r.push({op:"remove",path:a+"/"+G(p)}),n=!0):(s&&r.push({op:"test",path:a,value:e}),r.push({op:"replace",path:a,value:t}));else{var l=t[p];"object"==typeof d&&null!=d&&"object"==typeof l&&null!=l&&Array.isArray(d)===Array.isArray(l)?ne(d,l,r,a+"/"+G(p),s):d!==l&&(s&&r.push({op:"test",path:a+"/"+G(p),value:k(d)}),r.push({op:"replace",path:a+"/"+G(p),value:k(l)}))}}if(n||o.length!=i.length)for(c=0;c<o.length;c++){var p;P(e,p=o[c])||void 0===t[p]||r.push({op:"add",path:a+"/"+G(p),value:k(t[p])})}}}function ce(e,t,r){void 0===r&&(r=!1);var a=[];return ne(e,t,a,"",r),a}Object.assign({},r,a,{JsonPatchError:$,deepClone:k,escapePathComponent:G,unescapePathComponent:j});const de=window.popupMaker.i18n,le=window.wp.notices,pe=window.wp.htmlEntities;let ue=function(e){return e.Idle="IDLE",e.Resolving="RESOLVING",e.Error="ERROR",e.Success="SUCCESS",e}({});const Ee=window.wp.apiFetch;var ye=e.n(Ee);const Se="popup-maker/v2",ge=`${wpApiSettings.root}`,_e=`${wpApiSettings.root}${Se}/`,he=async(e,t={})=>{const r={"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce,...t.headers||{}},a=(e=>wpApiSettings.root.includes("?")?e.replace("?","&"):e)(e);try{return await ye()({url:`${ge}${a}`,...t,headers:r,credentials:"same-origin",parse:!0})}catch(e){if(e instanceof Error)throw e;if("object"==typeof e&&null!==e){const t=e;if("rest_invalid_param"===t.code)throw t;const r=t.message||"API request failed";throw new Error(r)}throw new Error("Unknown error occurred")}},Re=async(e,t={})=>he(`${Se}/${e}`,t),Ie=(e,t)=>{const r=Object.fromEntries(Object.entries(t).filter(([,e])=>!!e));return`${e}?${new URLSearchParams({...r})}`},me=e=>e instanceof Error?e.message:String("object"==typeof e&&null!==e&&"message"in e?e.message:e),fe=e=>e?!(e.title&&!e.title?.length)||{message:(0,de.__)("Please provide a name for this call to action.","popup-maker"),tabName:"general",field:"title"}:{message:(0,de.__)("Call to action not found","popup-maker")};function ve(e){return e&&"object"==typeof e&&"raw"in e}function Ae({_links:e,...t}){return Object.fromEntries(Object.entries(t).map(([e,t])=>[e,ve(t)?t.raw:t]))}const{RECEIVE_RECORD:Te,PURGE_RECORD:Oe,EDITOR_CHANGE_ID:Ne,EDIT_RECORD:Ce,START_EDITING_RECORD:De,SAVE_EDITED_RECORD:we,UNDO_EDIT_RECORD:be,REDO_EDIT_RECORD:He,RESET_EDIT_RECORD:Le,CHANGE_ACTION_STATUS:Ue,INVALIDATE_RESOLUTION:Pe}=E,xe=(e,t,r,a)=>!("rest_invalid_param"!==e?.code||!e?.data?.params)&&(t&&a.select(le.store).getNotices(d).filter(e=>e.id?.startsWith(`field-error-${t}-`)).forEach(e=>a.dispatch(le.store).removeNotice(e.id,d)),Object.entries(e.data.params).forEach(([a,s])=>{if("settings"===a&&e.data.details?.settings){const a=e.data.details.settings;a.data?.field&&r.createErrorNotice(a.message,{id:`field-error-${t||"new"}-${a.data.field}`,isDismissible:!1,type:"default"}),a.additional_errors&&Array.isArray(a.additional_errors)&&a.additional_errors.forEach(e=>{e.data?.field&&e.message&&r.createErrorNotice(e.message,{id:`field-error-${t||"new"}-${e.data.field}`,isDismissible:!1,type:"default"})})}else r.createErrorNotice(s,{id:`field-error-${t||"new"}-${a}`,isDismissible:!1,type:"default"})}),!0),ke={createCallToAction:(e,t=!0,r=!0)=>async({dispatch:a,registry:s})=>{const o="createCallToAction";try{a({type:Ue,payload:{actionName:o,status:ue.Resolving}});const{id:i,...n}=e;if(t){const e=fe(n);if(!0!==e)return a({type:Ue,payload:{actionName:o,status:ue.Error,message:e.message}}),r&&await a.createErrorNotice(e.message,{id:"call-to-action-validation-error"}),!1}const c=await Re("ctas?context=edit",{method:"POST",data:n});if(c)return s.batch(()=>{a({type:Ue,payload:{actionName:o,status:ue.Success}}),r&&a.createSuccessNotice((0,de.sprintf)(
// translators: %s: call to action title.
// translators: %s: call to action title.
(0,de.__)('Call to action "%s" saved successfully.',"popup-maker"),(0,pe.decodeEntities)(c?.title.rendered)),{id:"call-to-action-saved"}),a({type:Te,payload:{record:c}})}),c;a({type:Ue,payload:{actionName:o,status:ue.Error,message:(0,de.__)("An error occurred, call to action was not saved.","popup-maker")}})}catch(t){const i=me(t);throw a({type:Ue,payload:{actionName:o,status:ue.Error,message:i}}),r&&(xe(t,e?.id,a,s)||a.createErrorNotice(i,{id:"call-to-action-save-error"})),t}return!1},updateCallToAction:(e,t=!0,r=!0)=>async({select:a,dispatch:s,registry:o})=>{const i="updateCallToAction";try{if(s({type:Ue,payload:{actionName:i,status:ue.Resolving}}),t){const t=fe(e);if(!0!==t)return s({type:Ue,payload:{actionName:i,status:ue.Error,message:t.message}}),r&&await s.createErrorNotice(t.message,{id:"call-to-action-validation-error"}),!1}const n=await a.getCallToAction(e.id);if(!n)return s({type:Ue,payload:{actionName:i,status:ue.Error,message:(0,de.__)("Call to action not found","popup-maker")}}),e.id&&s({type:Ue,payload:{actionName:e.id.toString(),status:ue.Error,message:(0,de.__)("Call to action not found","popup-maker")}}),!1;const c=await Re(`ctas/${n.id}`,{method:"POST",data:e});if(c)return o.batch(()=>{s({type:Ue,payload:{actionName:i,status:ue.Success}}),r&&s.createSuccessNotice((0,de.sprintf)(
// translators: %s: call to action title.
// translators: %s: call to action title.
(0,de.__)('Call to action "%s" updated successfully.',"popup-maker"),(0,pe.decodeEntities)(c?.title.rendered)),{id:"call-to-action-saved"}),s({type:Te,payload:{record:c}})}),c;s({type:Ue,payload:{actionName:i,status:ue.Error,message:(0,de.__)("An error occurred, call to action was not saved.","popup-maker")}})}catch(t){const a=me(t);throw s({type:Ue,payload:{actionName:i,status:ue.Error,message:a}}),r&&(xe(t,e?.id,s,o)||s.createErrorNotice(a,{id:"call-to-action-save-error"})),t}return!1},deleteCallToAction:(e,t=!1,r=!0)=>async({dispatch:a,registry:s})=>{const o="deleteCallToAction";try{a({type:Ue,payload:{actionName:o,status:ue.Resolving}});const i=await Re(`ctas/${e}?context=edit`);if(!i)return a({type:Ue,payload:{actionName:o,status:ue.Error,message:(0,de.__)("Call to action not found","popup-maker")}}),!1;const n=t?"?force=true":"",c=await Re(`ctas/${e}${n}`,{method:"DELETE"});return c&&s.batch(()=>{a({type:Ue,payload:{actionName:o,status:ue.Success}}),r&&a.createSuccessNotice((0,de.sprintf)(
// translators: %s: call to action title.
// translators: %s: call to action title.
(0,de.__)('Call to action "%s" deleted successfully.',"popup-maker"),(0,pe.decodeEntities)(i?.title.rendered)),{id:"call-to-action-deleted"}),a(t?{type:Oe,payload:{id:e}}:{type:Te,payload:{record:{...i,status:"trash"}}})}),c}catch(e){throw a({type:Ue,payload:{actionName:o,status:ue.Error,message:(0,de.__)("Failed to delete entity","popup-maker")}}),r&&await a.createErrorNotice(e instanceof Error?e.message:(0,de.__)("Failed to delete entity","popup-maker")),e}}},Ve={editRecord:(e,t)=>async({select:r,dispatch:a,registry:s})=>{try{let o;const i=r.hasEditedEntity(e);if(i)o=r.getEditedCallToAction(e);else if(o=await Re(`ctas/${e}?context=edit`).then(e=>e?Ae(e):void 0),!o)return;s.batch(async()=>{i||await a({type:De,payload:{id:e,editableEntity:o}});const r=(0,b.mergeWith)({},(0,b.cloneDeep)(o),t,(e,t)=>{if(Array.isArray(t))return t.slice()}),s=ce(null!=o?o:{},r);await a({type:Ce,payload:{id:e,edits:s}})})}catch(e){const t=me(e);console.error("Edit failed:",e),await a.createErrorNotice(t,{id:"call-to-action-edit-error"})}},saveEditedRecord:(e,t=!0,r=!0)=>async({select:a,dispatch:s,registry:o})=>{const i="saveRecord";try{if(s({type:Ue,payload:{actionName:i,status:ue.Resolving}}),!a.hasEdits(e))return s({type:Ue,payload:{actionName:i,status:ue.Error,message:(0,de.__)("No edits to save","popup-maker")}}),!1;const n=a.getCurrentEditHistoryIndex(e),c=a.getEditedCallToAction(e);if(!c)return s({type:Ue,payload:{actionName:i,status:ue.Error,message:(0,de.__)("No edits to save","popup-maker")}}),!1;if(c&&t){const e=fe(c);if(!0!==e)return o.batch(async()=>{s({type:Ue,payload:{actionName:i,status:ue.Error,message:e.message}}),r&&await s.createErrorNotice(e.message,{id:"call-to-action-validation-error"})}),!1}const d=await s.updateCallToAction(c,!1,r);return!!d&&(o.batch(()=>{s({type:Ue,payload:{actionName:i,status:ue.Success}}),r&&s.createSuccessNotice((0,de.sprintf)(
// translators: %s: call to action title.
// translators: %s: call to action title.
(0,de.__)('Call to action "%s" saved successfully.',"popup-maker"),(0,pe.decodeEntities)(d?.title.rendered)),{id:"call-to-action-saved"}),s({type:we,payload:{id:e,historyIndex:n,editedEntity:Ae(d)}})}),!0)}catch(t){const a=me(t);throw console.error("Save failed:",t),o.batch(async()=>{s({type:Ue,payload:{actionName:i,status:ue.Error,message:a}}),r&&(xe(t,e,s,o)||await s.createErrorNotice(a,{id:"call-to-action-save-error"}))}),t}},undo:(e,t=1)=>async({select:r,dispatch:a})=>{const s=e>0?e:r.getEditorId();void 0!==s&&await a({type:be,payload:{id:s,steps:t}})},redo:(e,t=1)=>async({select:r,dispatch:a})=>{const s=e>0?e:r.getEditorId();void 0!==s&&await a({type:He,payload:{id:s,steps:t}})},resetRecordEdits:e=>async({select:t,dispatch:r})=>{const a=e>0?e:t.getEditorId();void 0!==a&&r({type:Le,payload:{id:a}})},updateEditorValues:e=>async({dispatch:t,select:r})=>{const a=r.getEditorId();void 0!==a&&t.editRecord(a,e)},saveEditorValues:()=>async({dispatch:e,select:t})=>{const r=t.getEditorId(),a=t.getCurrentEditorValues();return r&&a?e.saveEditedRecord(r):(e.createErrorNotice((0,de.__)("No editor values to save","popup-maker")),!1)},resetEditorValues:()=>async({dispatch:e,select:t})=>{const r=t.getEditorId();void 0!==r&&e.resetRecordEdits(r)},changeEditorId:e=>async({select:t,dispatch:r})=>{try{if(void 0===e)return void r({type:Ne,payload:{editorId:void 0}});if(t.hasEditedEntity(e))r({type:Ne,payload:{editorId:e}});else{const t=await Re(`ctas/${e}?context=edit`);if(!t)return void r.createErrorNotice((0,de.__)("Call to action not found","popup-maker"));r({type:De,payload:{id:e,editableEntity:Ae(t),setEditorId:!0}})}}catch(e){const t=me(e);console.error("Failed to change editor ID:",e),r.createErrorNotice(t,{id:"call-to-action-editor-error"})}}},Ge={...ke,createNotice:(e="info",t="",r)=>async({registry:a})=>{a.dispatch(le.store).createNotice(e,t,{...r,context:d})},createErrorNotice:(e,t)=>async({registry:r})=>{r.dispatch(le.store).createNotice("error",e,{...t,context:d})},createSuccessNotice:(e,t)=>async({registry:r})=>{r.dispatch(le.store).createNotice("success",e,{...t,context:d})},removeNotice:e=>async({registry:t})=>{t.dispatch(le.store).removeNotice(e,d)},removeAllNotices:e=>async({registry:t})=>{if(e)t.dispatch(le.store).removeNotices(e,d);else{const e=t.select(le.store).getNotices(d).map(e=>e.id);t.dispatch(le.store).removeNotices(e,d)}},...Ve,changeActionStatus:(e,t,r)=>({dispatch:a})=>{a({type:Ue,payload:{actionName:e,status:t,message:r}})},invalidateResolution:e=>({dispatch:t})=>{t({type:Pe,payload:{id:e}})}},je=window.wp.hooks,Fe={getCallToActions:(0,n.createSelector)(e=>e.allIds.map(t=>e.byId[t]),e=>[e.allIds,Object.keys(e.byId)]),getCallToAction:(0,n.createSelector)((e,t)=>{const r=e?.byId?.[t];return r},(e,t)=>[e,t]),getFetchError:(0,n.createSelector)((e,t)=>"number"==typeof t?e.errors.byId[t]:e.errors.global,(e,t)=>[e.errors,t]),getFiltered:(e,t,r=!1)=>r?Fe.getFilteredIds(e,t).map(t=>e.byId[t]):e.allIds.map(t=>e.byId[t]).filter(t),getFilteredIds:(e,t)=>e.allIds.filter(r=>t(e.byId[r]))},Me={getEditorId:(0,n.createSelector)(e=>e?.editorId,e=>[e.editorId]),isEditorActive:(0,n.createSelector)(e=>{const t=e?.editorId;return"string"==typeof t&&"new"===t||"number"==typeof t&&t>0},e=>[e.editorId]),getCurrentEditorValues:(0,n.createSelector)(e=>{const t=e?.editorId;if(void 0!==t)return Me.getEditedCallToAction(e,t)},e=>[e.editedEntities?.[e.editorId||0],e.editHistoryIndex?.[e.editorId||0],e.editHistory?.[e.editorId||0],e.editorId]),hasEditedEntity:(0,n.createSelector)((e,t)=>!!e?.editedEntities?.[t],(e,t)=>[e.editedEntities?.[t],t]),getEditedEntity:(0,n.createSelector)((e,t)=>e?.editedEntities?.[t],(e,t)=>[e.editedEntities?.[t],t]),getEntityEditHistory:(0,n.createSelector)((e,t)=>e?.editHistory?.[t],(e,t)=>[e.editHistory?.[t],t]),getCurrentEditHistoryIndex:(0,n.createSelector)((e,t)=>e.editHistoryIndex?.[t],(e,t)=>[e.editHistoryIndex?.[t],t]),hasEdits:(0,n.createSelector)((e,t)=>e.editHistory?.[t]?.length>0,(e,t)=>[e.editHistory?.[t],t]),hasUndo:(0,n.createSelector)((e,t)=>"number"==typeof e.editHistoryIndex?.[t]&&"object"==typeof e.editHistory?.[t]&&e.editHistoryIndex?.[t]>=0,(e,t)=>[e.editHistoryIndex?.[t],t]),hasRedo:(0,n.createSelector)((e,t)=>"number"==typeof e.editHistoryIndex?.[t]&&"object"==typeof e.editHistory?.[t]&&e.editHistoryIndex?.[t]<e.editHistory?.[t]?.length-1,(e,t)=>[e.editHistoryIndex?.[t],t]),getEditedCallToAction:(0,n.createSelector)((e,t)=>{var r;const a=e.editedEntities?.[t],s=e.editHistory?.[t],o=null!==(r=e.editHistoryIndex?.[t])&&void 0!==r?r:-1;if(a)return-1===o?a:s?.length?s.slice(0,o+1).reduce((e,t)=>W(e,Array.isArray(t)?t:[t],!0,!1).newDocument,a):a},(e,t)=>[e.editedEntities?.[t],e.editHistoryIndex?.[t],e.editHistory?.[t],t]),getDefaultValues:(0,n.createSelector)(e=>(0,je.applyFilters)("popupMaker.callToAction.defaultValues",S),e=>[e.editorId])},$e={getNotices:(0,n.createRegistrySelector)(e=>()=>e(le.store).getNotices(d)||[]),getNoticeById:(0,n.createRegistrySelector)(e=>t=>{const r=e(le.store).getNotices(d);return r?.find(e=>e.id===t)})},Ke={getResolutionState:(0,n.createSelector)((e,t)=>{const r=e.resolutionState?.[t];return r||{status:ue.Idle}},(e,t)=>[e.resolutionState,t]),isIdle:(0,n.createSelector)((e,t)=>Ke.getResolutionState(e,t).status===ue.Idle,(e,t)=>[t]),isResolving:(0,n.createSelector)((e,t)=>Ke.getResolutionState(e,t).status===ue.Resolving,(e,t)=>[t]),hasResolved:(0,n.createSelector)((e,t)=>Ke.getResolutionState(e,t).status===ue.Success,(e,t)=>[t]),hasFailed:(0,n.createSelector)((e,t)=>Ke.getResolutionState(e,t).status===ue.Error,(e,t)=>[t]),getResolutionError:(0,n.createSelector)((e,t)=>Ke.getResolutionState(e,t).error,(e,t)=>[e.resolutionState,t])},qe={...Fe,...Me,...$e,...Ke},Ye={getCallToActions:()=>async({dispatch:e})=>{try{const t=Ie("ctas",{status:["any","trash","auto-draft"],per_page:100,context:"edit"}),r=await Re(t,{method:"GET"});r.length&&e({type:p,payload:{records:r.map(({_links:e,...t})=>t)}})}catch(t){console.error(t),e({type:u,payload:{error:t.message}})}},getCallToAction:e=>async({dispatch:t})=>{try{const r=Ie(`ctas/${e}`,{context:"edit"}),{_links:a,...s}=await Re(r,{method:"GET"});t({type:l,payload:{record:s}})}catch(r){console.error(r),t({type:u,payload:{error:r.message,id:e}})}}},Qe=(0,n.createReduxStore)(c,{initialState:y,reducer:(e=y,t)=>{switch(t.type){case g:{const{record:r}=t.payload;return{...e,byId:{...e.byId,[r.id]:r},allIds:e.allIds.includes(r.id)?e.allIds:[...e.allIds,r.id]}}case _:case h:{const{records:r,query:a=!1}=t.payload,s=r.reduce((e,t)=>({...e,[t.id]:t}),e.byId),o=Array.from(new Set([...e.allIds,...r.map(e=>e.id)]));return{...e,allIds:o,byId:s,queries:a?{...e.queries,[JSON.stringify(a)]:r.map(e=>e.id)}:e.queries}}case R:{const{error:r,id:a=!1}=t.payload,s=e.errors||{global:null,byId:{}},o={...s.byId};return a?o[a]=r:s.global=r,{...e,errors:{global:a?s.global:r,byId:o}}}case m:case I:{const{ids:r=[],id:a=null}=t.payload;if(a&&a>0&&r.push(a),0===r.length)return e;const s=e.allIds.filter(e=>!r.includes(e)),o=Object.fromEntries(Object.entries(e.byId).filter(([e])=>!r.includes(e))),i=Object.fromEntries(Object.entries(e.editedEntities).filter(([e])=>!r.includes(e))),n=Object.fromEntries(Object.entries(e.editHistory).filter(([e])=>!r.includes(e))),c=Object.fromEntries(Object.entries(e.editHistoryIndex).filter(([e])=>!r.includes(e)));return{...e,byId:o,allIds:s,editedEntities:i,editHistory:n,editHistoryIndex:c}}case f:{const{editorId:r}=t.payload;return{...e,editorId:r}}case A:{const{id:r,editableEntity:a,setEditorId:s}=t.payload,o={...e,editedEntities:{...e.editedEntities,[r]:a}};return s?{...o,editorId:r}:o}case v:{var r,a;const{id:s,edits:o}=t.payload,i=null!==(r=e.editHistory[s])&&void 0!==r?r:[],n=null!==(a=e.editHistoryIndex[s])&&void 0!==a?a:-1,c=n<i.length-1?i.slice(0,n+1):i;return{...e,editHistory:{...e.editHistory,[s]:[...c,o]},editHistoryIndex:{...e.editHistoryIndex,[s]:c.length}}}case O:{var s;const{id:r,steps:a=1}=t.payload,o=null!==(s=e.editHistoryIndex[r])&&void 0!==s?s:-1,i=Math.max(-1,o-a);return{...e,editHistoryIndex:{...e.editHistoryIndex,[r]:i}}}case N:{var o,i;const{id:r,steps:a}=t.payload,s=null!==(o=e.editHistoryIndex[r])&&void 0!==o?o:-1,n=(null!==(i=e.editHistory[r]?.length)&&void 0!==i?i:0)-1,c=n>=0?Math.min(n,s+a):s;return{...e,editHistoryIndex:{...e.editHistoryIndex,[r]:c}}}case T:{const{id:r,historyIndex:a,editedEntity:s}=t.payload,o=e.editHistory[r].slice(a+1);return{...e,editedEntities:{...e.editedEntities,[r]:s},editHistory:{...e.editHistory,[r]:o},editHistoryIndex:{...e.editHistoryIndex,[r]:-1}}}case C:{const{id:r}=t.payload;return{...e,editedEntities:Object.fromEntries(Object.entries(e.editedEntities).filter(([e])=>Number(e)!==r)),editHistory:Object.fromEntries(Object.entries(e.editHistory).filter(([e])=>Number(e)!==r)),editHistoryIndex:Object.fromEntries(Object.entries(e.editHistoryIndex).filter(([e])=>Number(e)!==r))}}case D:{const{actionName:r,status:a,message:s}=t.payload;return{...e,resolutionState:{...e.resolutionState,[r]:{status:a,error:s}}}}case w:{const{id:r,operation:a}=t.payload;return{...e,resolutionState:{...e.resolutionState,[a]:{...e.resolutionState?.[a],[r]:void 0}}}}default:return e}},actions:Ge,selectors:qe,resolvers:Ye}),Je="popup-maker/license",Be="LICENSE_FETCH_ERROR",We={ACTIVATE_LICENSE:"ACTIVATE_LICENSE",CONNECT_SITE:"CONNECT_SITE",DEACTIVATE_LICENSE:"DEACTIVATE_LICENSE",REMOVE_LICENSE:"REMOVE_LICENSE",UPDATE_LICENSE_KEY:"UPDATE_LICENSE_KEY",CHECK_LICENSE_STATUS:"CHECK_LICENSE_STATUS",CHANGE_ACTION_STATUS:"CHANGE_ACTION_STATUS",HYDRATE_LICENSE_DATA:"HYDRATE_LICENSE_DATA",LICENSE_FETCH_ERROR:Be},Xe={success:!1,license:"invalid",license_limit:1,site_count:0,expires:"",activations_left:0,price_id:0,error:void 0,error_message:void 0},ze={key:"",status:Xe},Ze={license:ze},{ACTIVATE_LICENSE:et,CONNECT_SITE:tt,DEACTIVATE_LICENSE:rt,REMOVE_LICENSE:at,UPDATE_LICENSE_KEY:st,CHECK_LICENSE_STATUS:ot,HYDRATE_LICENSE_DATA:it,CHANGE_ACTION_STATUS:nt,LICENSE_FETCH_ERROR:ct}=We,dt=(e="")=>(e&&(e=`/${e}`),`popup-maker/v2/license${e}`),{ACTIVATE_LICENSE:lt,CONNECT_SITE:pt,DEACTIVATE_LICENSE:ut,UPDATE_LICENSE_KEY:Et,REMOVE_LICENSE:yt,CHECK_LICENSE_STATUS:St,HYDRATE_LICENSE_DATA:gt,CHANGE_ACTION_STATUS:_t}=We,ht=(e,t,r)=>(r&&console.log(e,r),{type:_t,actionName:e,status:t,message:r}),Rt=e=>async({dispatch:t})=>{const r="activateLicense";try{t.changeActionStatus(r,ue.Resolving);const a=await Re(dt("activate"),{method:"POST",data:{licenseKey:e}});if(a){const{status:e,connectInfo:s}=a;return t.changeActionStatus(r,ue.Success),void 0!==s&&t({type:pt,licenseStatus:e,connectInfo:s}),void t({type:lt,licenseStatus:e})}t.changeActionStatus(r,ue.Error,(0,de.__)("An error occurred, license were not saved.","popup-maker"))}catch(e){t.changeActionStatus(r,ue.Error,me(e))}},It=()=>async({dispatch:e})=>{const t="deactivateLicense";try{e.changeActionStatus(t,ue.Resolving);const r=await Re(dt("deactivate"),{method:"POST"});if(r)return e.changeActionStatus(t,ue.Success),void e({type:ut,licenseStatus:r.status});e.changeActionStatus(t,ue.Error,(0,de.__)("An error occurred, license were not saved.","popup-maker"))}catch(r){e.changeActionStatus(t,ue.Error,me(r))}},mt=()=>async({dispatch:e})=>{const t="checkLicenseStatus";try{e.changeActionStatus(t,ue.Resolving);const r=await Re(dt("status"),{method:"POST"});if(r)return e.changeActionStatus(t,ue.Success),void e({type:St,licenseStatus:r.status});e.changeActionStatus(t,ue.Error,(0,de.__)("An error occurred, license were not saved.","popup-maker"))}catch(r){e.changeActionStatus(t,ue.Error,me(r))}},ft=e=>async({select:t,dispatch:r})=>{const a="updateLicenseKey";if(t.getLicenseKey()!==e)try{r.changeActionStatus(a,ue.Resolving);const t=await Re(dt(),{method:"POST",data:{licenseKey:e}});if(t)return r.changeActionStatus(a,ue.Success),void r({type:Et,licenseKey:e,licenseStatus:t.status});r.changeActionStatus(a,ue.Error,(0,de.__)("An error occurred, license were not saved.","popup-maker"))}catch(e){r.changeActionStatus(a,ue.Error,me(e))}else r.changeActionStatus(a,ue.Error,(0,de.__)("The license key is the same as the current one.","popup-maker"))},vt=()=>async({dispatch:e})=>{const t="removeLicense";try{if(e.changeActionStatus(t,ue.Resolving),await Re(dt(),{method:"DELETE"}))return e.changeActionStatus(t,ue.Success),void e({type:yt});e.changeActionStatus(t,ue.Error,(0,de.__)("An error occurred, license were not saved.","popup-maker"))}catch(r){e.changeActionStatus(t,ue.Error,me(r))}},At=()=>async({dispatch:e})=>{const t="activatePro";try{if(e.changeActionStatus(t,ue.Resolving),await Re(dt("activate-pro"),{method:"POST"}))return void e.changeActionStatus(t,ue.Success);e.changeActionStatus(t,ue.Error,(0,de.__)("An error occurred, license were not saved.","popup-maker"))}catch(r){e.changeActionStatus(t,ue.Error,me(r))}},Tt=e=>({type:gt,license:e}),Ot=()=>async({dispatch:e})=>{try{const t=await Re(dt(),{method:"GET"});if(t)return void e.hydrate(t);e({type:Be,message:(0,de.__)("An error occurred, license data was not loaded.","popup-maker")})}catch(t){e({type:Be,message:me(t)})}},Nt=()=>async({resolveSelect:e})=>{var t;const{key:r=""}=null!==(t=await e.getLicenseData())&&void 0!==t?t:{};return r},Ct=()=>async({resolveSelect:e})=>{var t;const{status:r}=null!==(t=await e.getLicenseData())&&void 0!==t?t:{};return r},Dt=e=>e.license,wt=e=>{const{key:t}=Dt(e);return t},bt=(0,n.createSelector)(e=>{const{status:t}=Dt(e);return{...Xe,...t}},e=>[e.license.status]),Ht=e=>e.connectInfo,Lt=(e,t)=>e?.dispatchStatus?.[t]?.status,Ut=(0,n.createSelector)((e,t)=>{if(!Array.isArray(t))return Lt(e,t)===ue.Resolving;let r=!1;for(let a=0;t.length>a;a++)if(r=Lt(e,t[a])===ue.Resolving,r)return!0;return r},(e,t)=>[e.dispatchStatus,t]),Pt=(0,n.createSelector)((e,t)=>{const r=Lt(e,t);return!!(r&&[ue.Success,ue.Error].indexOf(r)>=0)},(e,t)=>[e.dispatchStatus,t]),xt=(e,t)=>e?.dispatchStatus?.[t]?.error,kt=(0,n.createReduxStore)(Je,{initialState:Ze,reducer:(e=Ze,t)=>{switch(t.type){case et:case rt:case ot:return{...e,license:{...e.license,status:t.licenseStatus}};case tt:return{...e,license:{...e.license,status:t.licenseStatus},connectInfo:t.connectInfo};case st:return{...e,license:{...e.license,key:t.licenseKey,status:t.licenseStatus}};case at:return{...e,license:{key:"",status:{}}};case it:return{...e,license:t.license};case ct:return{...e,error:t.message};case nt:return{...e,dispatchStatus:{...e.dispatchStatus,[t.actionName]:{...e?.dispatchStatus?.[t.actionName],status:t.status,error:t.message}}};default:return e}},actions:s,selectors:i,resolvers:o}),Vt="popup-maker/popups",Gt="pum-popup-editor",jt="RECEIVE_RECORD",Ft="RECEIVE_RECORDS",Mt={RECEIVE_RECORD:jt,RECEIVE_RECORDS:Ft,RECEIVE_QUERY_RECORDS:"RECEIVE_QUERY_RECORDS",RECEIVE_ERROR:"RECEIVE_ERROR",PURGE_RECORDS:"PURGE_RECORDS",PURGE_RECORD:"PURGE_RECORD",EDITOR_CHANGE_ID:"EDITOR_CHANGE_ID",EDIT_RECORD:"EDIT_RECORD",START_EDITING_RECORD:"START_EDITING_RECORD",SAVE_EDITED_RECORD:"SAVE_EDITED_RECORD",UNDO_EDIT_RECORD:"UNDO_EDIT_RECORD",REDO_EDIT_RECORD:"REDO_EDIT_RECORD",RESET_EDIT_RECORD:"RESET_EDIT_RECORD",CHANGE_ACTION_STATUS:"CHANGE_ACTION_STATUS",START_RESOLUTION:"START_RESOLUTION",FINISH_RESOLUTION:"FINISH_RESOLUTION",FAIL_RESOLUTION:"FAIL_RESOLUTION",INVALIDATE_RESOLUTION:"INVALIDATE_RESOLUTION"},$t={byId:{},allIds:[],queries:{},editorId:void 0,editedEntities:{},editHistory:{},editHistoryIndex:{},resolutionState:{},notices:{},errors:{global:null,byId:{}}},Kt={id:0,uuid:"",slug:"",title:"",content:"",excerpt:"",status:"draft",enabled:!1,settings:{conditions:{logicalOperator:"or",items:[]}},date:null,date_gmt:null,guid:"",link:"",modified:"",modified_gmt:"",type:"popup",author:0,generated_slug:"",permalink_template:"",password:"",featured_media:0,comment_status:"open",ping_status:"open",format:"standard",meta:{},sticky:!1,template:"",categories:[],tags:[]},{RECEIVE_RECORD:qt,RECEIVE_RECORDS:Yt,RECEIVE_QUERY_RECORDS:Qt,RECEIVE_ERROR:Jt,PURGE_RECORD:Bt,PURGE_RECORDS:Wt,EDITOR_CHANGE_ID:Xt,EDIT_RECORD:zt,START_EDITING_RECORD:Zt,SAVE_EDITED_RECORD:er,UNDO_EDIT_RECORD:tr,REDO_EDIT_RECORD:rr,RESET_EDIT_RECORD:ar,INVALIDATE_RESOLUTION:sr,CHANGE_ACTION_STATUS:or}=Mt,ir=e=>e?e.title&&!e.title?.length?{message:(0,de.__)("Please provide a name for this popup.","popup-maker"),tabName:"general",field:"title"}:!(!e.settings?.conditions?.items?.length&&"publish"===e.status)||{message:(0,de.__)("Please provide at least one condition for this popup before enabling it.","popup-maker"),tabName:"content"}:{message:(0,de.__)("Popup not found","popup-maker")};function nr(e){return e&&"object"==typeof e&&"raw"in e}function cr(e){return Object.fromEntries(Object.entries(e).map(([e,t])=>[e,nr(t)?t.raw:t]))}const{RECEIVE_RECORD:dr,PURGE_RECORD:lr,EDITOR_CHANGE_ID:pr,EDIT_RECORD:ur,START_EDITING_RECORD:Er,SAVE_EDITED_RECORD:yr,UNDO_EDIT_RECORD:Sr,REDO_EDIT_RECORD:gr,RESET_EDIT_RECORD:_r,CHANGE_ACTION_STATUS:hr,INVALIDATE_RESOLUTION:Rr}=Mt,Ir={createPopup:(e,t=!0,r=!0)=>async({dispatch:a,registry:s})=>{const o="createPopup";try{a({type:hr,payload:{actionName:o,status:ue.Resolving}});const{id:i,...n}=e;if(t){const e=ir(n);if(!0!==e)return a({type:hr,payload:{actionName:o,status:ue.Error,message:e.message}}),r&&await a.createErrorNotice(e.message,{id:"popup-validation-error"}),!1}const c=await Re("popups?context=edit",{method:"POST",data:n});if(c)return s.batch(()=>{a({type:hr,payload:{actionName:o,status:ue.Success}}),r&&a.createSuccessNotice((0,de.sprintf)(
// translators: %s: popup title.
// translators: %s: popup title.
(0,de.__)('Popup "%s" saved successfully.',"popup-maker"),(0,pe.decodeEntities)(c?.title.rendered)),{id:"popup-saved"}),a({type:dr,payload:{record:c}})}),c;a({type:hr,payload:{actionName:o,status:ue.Error,message:(0,de.__)("An error occurred, popup was not saved.","popup-maker")}})}catch(e){const t=me(e);throw a({type:hr,payload:{actionName:o,status:ue.Error,message:t}}),r&&a.createErrorNotice(t),e}return!1},updatePopup:(e,t=!0,r=!0)=>async({select:a,dispatch:s,registry:o})=>{const i="updatePopup";try{if(s({type:hr,payload:{actionName:i,status:ue.Resolving}}),t){const t=ir(e);if(!0!==t)return s({type:hr,payload:{actionName:i,status:ue.Error,message:t.message}}),r&&await s.createErrorNotice(t.message,{id:"popup-validation-error"}),!1}const n=await a.getPopup(e.id);if(!n)return s({type:hr,payload:{actionName:i,status:ue.Error,message:(0,de.__)("Popup not found","popup-maker")}}),!1;const c=await Re(`popups/${n.id}`,{method:"POST",data:e});if(c)return o.batch(()=>{s({type:hr,payload:{actionName:i,status:ue.Success}})}),r&&s.createSuccessNotice((0,de.sprintf)(
// translators: %s: popup title.
// translators: %s: popup title.
(0,de.__)('Popup "%s" updated successfully.',"popup-maker"),(0,pe.decodeEntities)(c?.title.rendered)),{id:"popup-saved"}),s({type:dr,payload:{record:c}}),c;s({type:hr,payload:{actionName:i,status:ue.Error,message:(0,de.__)("An error occurred, popup was not saved.","popup-maker")}})}catch(e){const t=me(e);throw s({type:hr,payload:{actionName:i,status:ue.Error,message:t}}),r&&s.createErrorNotice(t),e}return!1},deletePopup:(e,t=!1,r=!0)=>async({dispatch:a,registry:s})=>{const o="deletePopup";try{a({type:hr,payload:{actionName:o,status:ue.Resolving}});const i=await Re(`popups/${e}?context=edit`);if(!i)return a({type:hr,payload:{actionName:o,status:ue.Error,message:(0,de.__)("Popup not found","popup-maker")}}),!1;const n=t?"?force=true":"",c=await Re(`popups/${e}${n}`,{method:"DELETE"});return c&&s.batch(()=>{a({type:hr,payload:{actionName:o,status:ue.Success}}),r&&a.createSuccessNotice((0,de.sprintf)(
// translators: %s: popup title.
// translators: %s: popup title.
(0,de.__)('Popup "%s" deleted successfully.',"popup-maker"),(0,pe.decodeEntities)(i?.title.rendered)),{id:"popup-deleted"}),a(t?{type:lr,payload:{id:e}}:{type:dr,payload:{record:{...i,status:"trash"}}})}),c}catch(e){throw a({type:hr,payload:{actionName:o,status:ue.Error,message:(0,de.__)("Popup not found","popup-maker")}}),r&&await a.createErrorNotice(e instanceof Error?e.message:(0,de.__)("Failed to delete entity","popup-maker")),e}},editRecord:(e,t)=>async({select:r,dispatch:a,registry:s})=>{try{let o;const i=r.hasEditedEntity(e);if(i)o=r.getEditedPopup(e);else if(o=await Re(`popups/${e}?context=edit`).then(e=>e?cr(e):void 0),!o)return;s.batch(async()=>{i||await a({type:Er,payload:{id:e,editableEntity:o}});const r=(0,b.mergeWith)({},(0,b.cloneDeep)(o),t,(e,t)=>{if(Array.isArray(t))return t.slice()}),s=ce(null!=o?o:{},r);await a({type:ur,payload:{id:e,edits:s}})})}catch(e){const t=me(e);console.error("Edit failed:",e),await a.createErrorNotice(t)}},saveEditedRecord:(e,t=!0,r=!0)=>async({select:a,dispatch:s,registry:o})=>{const i="saveRecord";try{if(s({type:hr,payload:{actionName:i,status:ue.Resolving}}),!a.hasEdits(e))return s({type:hr,payload:{actionName:i,status:ue.Error,message:(0,de.__)("No edits to save","popup-maker")}}),!1;const n=a.getCurrentEditHistoryIndex(e),c=a.getEditedPopup(e);if(!c)return s({type:hr,payload:{actionName:i,status:ue.Error,message:(0,de.__)("No edits to save","popup-maker")}}),!1;if(c&&t){const e=ir(c);if(!0!==e)return o.batch(async()=>{s({type:hr,payload:{actionName:i,status:ue.Error,message:e.message}}),r&&await s.createErrorNotice(e.message,{id:"popup-validation-error"})}),!1}const d=await s.updatePopup(c,!1,!1);return!!d&&(o.batch(()=>{s({type:hr,payload:{actionName:i,status:ue.Success}}),r&&s.createSuccessNotice((0,de.sprintf)(
// translators: %s: popup title.
// translators: %s: popup title.
(0,de.__)('Popup "%s" saved successfully.',"popup-maker"),(0,pe.decodeEntities)(d?.title.rendered)),{id:"popup-saved"}),s({type:yr,payload:{id:e,historyIndex:n,editedEntity:cr(d)}})}),!0)}catch(e){const t=me(e);throw console.error("Save failed:",e),o.batch(async()=>{r&&await s.createErrorNotice(t),s({type:hr,payload:{actionName:i,status:ue.Error,message:t}})}),e}},undo:(e,t=1)=>async({select:r,dispatch:a})=>{const s=e>0?e:r.getEditorId();void 0!==s&&await a({type:Sr,payload:{id:s,steps:t}})},redo:(e,t=1)=>async({select:r,dispatch:a})=>{const s=e>0?e:r.getEditorId();void 0!==s&&await a({type:gr,payload:{id:s,steps:t}})},resetRecordEdits:e=>async({select:t,dispatch:r})=>{const a=e>0?e:t.getEditorId();void 0!==a&&r({type:_r,payload:{id:a}})},updateEditorValues:e=>async({dispatch:t,select:r})=>{const a=r.getEditorId();void 0!==a&&t.editRecord(a,e)},saveEditorValues:()=>async({dispatch:e,select:t})=>{const r=t.getEditorId(),a=t.getCurrentEditorValues();return r&&a?e.saveEditedRecord(r):(e.createErrorNotice((0,de.__)("No editor values to save","popup-maker")),!1)},resetEditorValues:()=>async({dispatch:e,select:t})=>{const r=t.getEditorId();void 0!==r&&e.resetRecordEdits(r)},changeEditorId:e=>async({select:t,dispatch:r})=>{try{if(void 0===e)return void r({type:pr,payload:{editorId:void 0}});if(!t.hasEditedEntity(e)){const t=await Re(`popups/${e}?context=edit`);if(!t)return void r.createErrorNotice((0,de.__)("Popup not found","popup-maker"));r({type:Er,payload:{id:e,editableEntity:cr(t),setEditorId:!0}})}r({type:pr,payload:{editorId:e}})}catch(e){const t=me(e);console.error("Failed to change editor ID:",e),r.createErrorNotice(t)}},createNotice:(e="info",t="",r)=>async({registry:a})=>{a.dispatch(le.store).createNotice(e,t,{...r,context:Gt})},createErrorNotice:(e,t)=>async({registry:r})=>{r.dispatch(le.store).createNotice("error",e,{...t,context:Gt})},createSuccessNotice:(e,t)=>async({registry:r})=>{r.dispatch(le.store).createNotice("success",e,{...t,context:Gt})},removeNotice:e=>async({registry:t})=>{t.dispatch(le.store).removeNotice(e,Gt)},removeAllNotices:e=>async({registry:t})=>{if(e)t.dispatch(le.store).removeNotices(e,Gt);else{const e=t.select(le.store).getNotices(Gt).map(e=>e.id);t.dispatch(le.store).removeNotices(e,Gt)}},changeActionStatus:(e,t,r)=>({dispatch:a})=>{r&&console.log(e,r),a({type:hr,payload:{actionName:e,status:t,message:r}})},invalidateResolution:e=>({dispatch:t})=>{t({type:Rr,payload:{id:e}})}},mr=(0,n.createSelector)(e=>e.allIds.map(t=>e.byId[t]),e=>[e.allIds,e.byId]),fr=(0,n.createSelector)((e,t)=>{const r=e?.byId?.[t];return r},(e,t)=>[e,t]),vr=(0,n.createSelector)((e,t)=>"number"==typeof t?e.errors.byId[t]:e.errors.global,(e,t)=>[e.errors,t]),Ar=(e,t)=>e.allIds.filter(r=>t(e.byId[r])),Tr=(0,n.createSelector)(e=>e?.editorId,e=>[e.editorId]),Or=(0,n.createSelector)(e=>{const t=e?.editorId;return"string"==typeof t&&"new"===t||"number"==typeof t&&t>0},e=>[e.editorId]),Nr=(0,n.createSelector)(e=>{const t=e?.editorId;if(void 0!==t)return Pr(e,t)},e=>[e.editedEntities?.[e.editorId||0],e.editHistoryIndex?.[e.editorId||0],e.editHistory?.[e.editorId||0],e.editorId]),Cr=(0,n.createSelector)((e,t)=>!!e?.editedEntities?.[t],(e,t)=>[e.editedEntities?.[t],t]),Dr=(0,n.createSelector)((e,t)=>e?.editedEntities?.[t],(e,t)=>[e.editedEntities?.[t],t]),wr=(0,n.createSelector)((e,t)=>e?.editHistory?.[t],(e,t)=>[e.editHistory?.[t],t]),br=(0,n.createSelector)((e,t)=>e.editHistoryIndex?.[t],(e,t)=>[e.editHistoryIndex?.[t],t]),Hr=(0,n.createSelector)((e,t)=>e.editHistory?.[t]?.length>0,(e,t)=>[e.editHistory?.[t],t]),Lr=(0,n.createSelector)((e,t)=>"number"==typeof e.editHistoryIndex?.[t]&&"object"==typeof e.editHistory?.[t]&&e.editHistoryIndex?.[t]>=0,(e,t)=>[e.editHistoryIndex?.[t],t]),Ur=(0,n.createSelector)((e,t)=>"number"==typeof e.editHistoryIndex?.[t]&&"object"==typeof e.editHistory?.[t]&&e.editHistoryIndex?.[t]<e.editHistory?.[t]?.length-1,(e,t)=>[e.editHistoryIndex?.[t],t]),Pr=(0,n.createSelector)((e,t)=>{const r=e.editedEntities?.[t],a=e.editHistory?.[t],s=e.editHistoryIndex?.[t];if(r)return-1===s?r:a?.length?a.slice(0,s+1).reduce((e,t)=>W(e,Array.isArray(t)?t:[t],!0,!1).newDocument,r):r},(e,t)=>[e.editedEntities?.[t],e.editHistoryIndex?.[t],e.editHistory?.[t],t]),xr=(0,n.createSelector)(e=>(0,je.applyFilters)("popupMaker.popup.defaultValues",Kt),e=>[e.editorId]),kr=(0,n.createRegistrySelector)(e=>()=>e(le.store).getNotices(Gt)||[]),Vr=(0,n.createRegistrySelector)(e=>t=>{const r=e(le.store).getNotices(Gt);return r?.find(e=>e.id===t)}),Gr=(0,n.createSelector)((e,t)=>{const r=e.resolutionState?.[t];return r||{status:ue.Idle}},(e,t)=>[e.resolutionState,t]),jr=(0,n.createSelector)((e,t)=>Gr(e,t).status===ue.Idle,(e,t)=>[t]),Fr=(0,n.createSelector)((e,t)=>Gr(e,t).status===ue.Resolving,(e,t)=>[t]),Mr=(0,n.createSelector)((e,t)=>Gr(e,t).status===ue.Success,(e,t)=>[t]),$r=(0,n.createSelector)((e,t)=>Gr(e,t).status===ue.Error,(e,t)=>[t]),Kr=(0,n.createSelector)((e,t)=>Gr(e,t).error,(e,t)=>[e.resolutionState,t]),qr={getPopups:mr,getPopup:fr,getFetchError:vr,getFiltered:(e,t,r=!1)=>r?Ar(e,t).map(t=>e.byId[t]):e.allIds.map(t=>e.byId[t]).filter(t),getFilteredIds:Ar,getEditorId:Tr,isEditorActive:Or,getCurrentEditorValues:Nr,hasEditedEntity:Cr,getEditedEntity:Dr,getEntityEditHistory:wr,getCurrentEditHistoryIndex:br,hasEdits:Hr,hasUndo:Lr,hasRedo:Ur,getEditedPopup:Pr,getDefaultValues:xr,getNotices:kr,getNoticeById:Vr,getResolutionState:Gr,isIdle:jr,isResolving:Fr,hasResolved:Mr,hasFailed:$r,getResolutionError:Kr},Yr={getPopups:()=>async({dispatch:e})=>{try{const t=Ie("popups",{status:["any","trash","auto-draft"],per_page:100,context:"edit"}),r=await Re(t,{method:"GET"});r.length&&e({type:Ft,payload:{records:r}})}catch(e){console.error(e)}},getPopup:e=>async({dispatch:t})=>{try{const r=Ie(`popups/${e}`,{context:"edit"}),a=await Re(r,{method:"GET"});t({type:jt,payload:{record:a}})}catch(e){console.error(e)}}},Qr=(0,n.createReduxStore)(Vt,{initialState:$t,reducer:(e=$t,t)=>{switch(t.type){case qt:{const{record:r}=t.payload;return{...e,byId:{...e.byId,[r.id]:r},allIds:e.allIds.includes(r.id)?e.allIds:[...e.allIds,r.id]}}case Yt:case Qt:{const{records:r,query:a=!1}=t.payload,s=r.reduce((e,t)=>({...e,[t.id]:t}),e.byId),o=Array.from(new Set([...e.allIds,...r.map(e=>e.id)]));return{...e,allIds:o,byId:s,queries:a?{...e.queries,[JSON.stringify(a)]:r.map(e=>e.id)}:e.queries}}case Jt:{const{error:r,id:a=!1}=t.payload,s=e.errors||{global:null,byId:{}},o={...s.byId};return a?o[a]=r:s.global=r,{...e,errors:{global:a?s.global:r,byId:o}}}case Wt:case Bt:{const{ids:r=[],id:a=null}=t.payload;if(a&&a>0&&r.push(a),0===r.length)return e;const s=e.allIds.filter(e=>!r.includes(e)),o=Object.fromEntries(Object.entries(e.byId).filter(([e])=>!r.includes(e))),i=Object.fromEntries(Object.entries(e.editedEntities).filter(([e])=>!r.includes(e))),n=Object.fromEntries(Object.entries(e.editHistory).filter(([e])=>!r.includes(e))),c=Object.fromEntries(Object.entries(e.editHistoryIndex).filter(([e])=>!r.includes(e)));return{...e,byId:o,allIds:s,editedEntities:i,editHistory:n,editHistoryIndex:c}}case Xt:{const{editorId:r}=t.payload;return{...e,editorId:r}}case Zt:{const{id:r,editableEntity:a,setEditorId:s}=t.payload,o={...e,editedEntities:{...e.editedEntities,[r]:a}};return s?{...o,editorId:r}:o}case zt:{var r,a;const{id:s,edits:o}=t.payload,i=null!==(r=e.editHistory[s])&&void 0!==r?r:[],n=null!==(a=e.editHistoryIndex[s])&&void 0!==a?a:-1,c=n<i.length-1?i.slice(0,n+1):i;return{...e,editHistory:{...e.editHistory,[s]:[...c,o]},editHistoryIndex:{...e.editHistoryIndex,[s]:c.length}}}case tr:{var s;const{id:r,steps:a=1}=t.payload,o=null!==(s=e.editHistoryIndex[r])&&void 0!==s?s:-1,i=Math.max(-1,o-a);return{...e,editHistoryIndex:{...e.editHistoryIndex,[r]:i}}}case rr:{var o,i;const{id:r,steps:a}=t.payload,s=null!==(o=e.editHistoryIndex[r])&&void 0!==o?o:-1,n=(null!==(i=e.editHistory[r]?.length)&&void 0!==i?i:0)-1,c=n>=0?Math.min(n,s+a):s;return{...e,editHistoryIndex:{...e.editHistoryIndex,[r]:c}}}case er:{const{id:r,historyIndex:a,editedEntity:s}=t.payload,o=e.editHistory[r].slice(a+1);return{...e,editedEntities:{...e.editedEntities,[r]:s},editHistory:{...e.editHistory,[r]:o},editHistoryIndex:{...e.editHistoryIndex,[r]:-1}}}case ar:{const{id:r}=t.payload;return{...e,editedEntities:Object.fromEntries(Object.entries(e.editedEntities).filter(([e])=>Number(e)!==r)),editHistory:Object.fromEntries(Object.entries(e.editHistory).filter(([e])=>Number(e)!==r)),editHistoryIndex:Object.fromEntries(Object.entries(e.editHistoryIndex).filter(([e])=>Number(e)!==r))}}case or:{const{actionName:r,status:a,message:s}=t.payload;return{...e,resolutionState:{...e.resolutionState,[r]:{status:a,error:s}}}}case sr:{const{id:r,operation:a}=t.payload;return{...e,resolutionState:{...e.resolutionState,[a]:{...e.resolutionState?.[a],[r]:void 0}}}}default:return e}},actions:Ir,selectors:qr,resolvers:Yr});var Jr;const Br="popup-maker/settings",Wr="SETTINGS_FETCH_ERROR",Xr={UPDATE:"UPDATE",STAGE_CHANGES:"STAGE_CHANGES",SAVE_CHANGES:"SAVE_CHANGES",HYDRATE:"HYDRATE",CHANGE_ACTION_STATUS:"CHANGE_ACTION_STATUS",INVALIDATE_RESOLUTION:"INVALIDATE_RESOLUTION",SETTINGS_FETCH_ERROR:Wr},zr=(0,je.applyFilters)("popupMaker.defaultSettings",{permissions:{view_block_controls:"edit_posts",edit_block_controls:"edit_posts",edit_restrictions:"manage_options",manage_settings:"manage_options"}}),{currentSettings:Zr=zr}=null!==(Jr=popupMakerCoreData)&&void 0!==Jr?Jr:{},ea={settings:Zr,unsavedChanges:{},resolutionState:{}},{UPDATE:ta,STAGE_CHANGES:ra,SAVE_CHANGES:aa,HYDRATE:sa,CHANGE_ACTION_STATUS:oa,SETTINGS_FETCH_ERROR:ia,INVALIDATE_RESOLUTION:na}=Xr,{UPDATE:ca,SAVE_CHANGES:da,STAGE_CHANGES:la,HYDRATE:pa,CHANGE_ACTION_STATUS:ua,INVALIDATE_RESOLUTION:Ea}=Xr,ya={updateSettings:e=>async({dispatch:t,resolveSelect:r})=>{const a="updateSettings";try{t.changeActionStatus(a,ue.Resolving);const s=await r.getSettings(),o=await Re("popup-maker/v2/settings",{method:"PUT",data:{settings:{...s,...e}}});if(o)return t.changeActionStatus(a,ue.Success),void t({type:ca,payload:{settings:o}});t.changeActionStatus(a,ue.Error,(0,de.__)("An error occurred, settings were not saved.","popup-maker"))}catch(e){t.changeActionStatus(a,ue.Error,me(e))}},saveSettings:e=>async({dispatch:t,resolveSelect:r})=>{const a="saveSettings";try{t.changeActionStatus(a,ue.Resolving);const s=await r.getSettings(),o=await r.getUnsavedChanges(),i=await Re("popup-maker/v2/settings",{method:"PUT",data:{settings:{...s,...o,...e}}});if(i)return t.changeActionStatus(a,ue.Success),void t({type:da,payload:{settings:i}});t.changeActionStatus(a,ue.Error,(0,de.__)("An error occurred, settings were not saved.","popup-maker"))}catch(e){t.changeActionStatus(a,ue.Error,me(e))}},stageUnsavedChanges:e=>({type:la,payload:{settings:e}}),hydrate:e=>({type:pa,payload:{settings:e}})},Sa={...ya,changeActionStatus:(e,t,r)=>({dispatch:a})=>{r&&console.log(e,r),a({type:ua,actionName:e,status:t,message:r})},invalidateResolution:e=>({dispatch:t})=>{t({type:Ea,payload:{id:e}})}},ga={getSettings:()=>async({dispatch:e,registry:t})=>{try{const r=await Re("popup-maker/v2/settings",{method:"GET"});t.batch(()=>{r&&e.hydrate(r),e({type:Wr,message:(0,de.__)("An error occurred, settings were not loaded.","popup-maker")})})}catch(t){e({type:Wr,message:me(t)})}}},_a={getSettings:(0,n.createSelector)(e=>e.settings,e=>[e.settings]),getSetting:(0,n.createSelector)((e,t,r)=>{var a;return null!==(a=_a.getSettings(e)[t])&&void 0!==a?a:r},(e,t,r)=>[e.settings,t,r]),getUnsavedChanges:(0,n.createSelector)(e=>e.unsavedChanges,e=>[e.unsavedChanges]),hasUnsavedChanges:(0,n.createSelector)(e=>{var t;return Object.keys(null!==(t=e?.unsavedChanges)&&void 0!==t?t:{}).length>0},e=>[e.unsavedChanges]),getReqPermission:(0,n.createSelector)((e,t)=>{const r=_a.getSetting(e,"permissions",zr.permissions)[t];return"string"==typeof r?r:"manage_options"},(e,t)=>[e.settings.permissions,t])},ha={getResolutionState:(0,n.createSelector)((e,t)=>{const r=e.resolutionState?.[t];return r||{status:ue.Idle}},(e,t)=>[t]),isIdle:(0,n.createSelector)((e,t)=>ha.getResolutionState(e,t).status===ue.Idle,(e,t)=>[t]),isResolving:(0,n.createSelector)((e,t)=>ha.getResolutionState(e,t).status===ue.Resolving,(e,t)=>[t]),hasResolved:(0,n.createSelector)((e,t)=>ha.getResolutionState(e,t).status===ue.Success,(e,t)=>[t]),hasFailed:(0,n.createSelector)((e,t)=>ha.getResolutionState(e,t).status===ue.Error,(e,t)=>[t]),getResolutionError:(0,n.createSelector)((e,t)=>ha.getResolutionState(e,t).error,(e,t)=>[t])},Ra={..._a,...ha},Ia=(0,n.createReduxStore)(Br,{initialState:ea,reducer:(e=ea,t)=>{switch(t.type){case sa:{const{settings:r}=t.payload;return{...e,settings:r}}case ia:{const{message:r}=t.payload;return{...e,error:r}}case ra:{var r;const{settings:a}=t.payload;return{...e,unsavedChanges:{...null!==(r=e.unsavedChanges)&&void 0!==r?r:{},...a}}}case aa:{const{settings:r}=t.payload;return{...e,settings:{...e.settings,...r},unsavedChanges:{}}}case ta:{const{settings:r}=t.payload;return{...e,settings:{...e.settings,...r}}}case oa:{const{actionName:r,status:a,message:s}=t.payload;return{...e,resolutionState:{...e.resolutionState,[r]:{status:a,error:s}}}}case na:{const{id:r,operation:a}=t.payload;return{...e,resolutionState:{...e.resolutionState,[a]:{...e.resolutionState?.[a],[r]:void 0}}}}default:return e}},actions:Sa,selectors:Ra,resolvers:ga}),ma="popup-maker/url-search",fa={SEARCH_REQUEST:"SEARCH_REQUEST",SEARCH_SUCCESS:"SEARCH_SUCCESS",SEARCH_ERROR:"SEARCH_ERROR",UPDATE_SUGGESTIONS:"UPDATE_SUGGESTIONS",CHANGE_ACTION_STATUS:"CHANGE_ACTION_STATUS",INVALIDATE_RESOLUTION:"INVALIDATE_RESOLUTION"},va={currentQuery:"",searchResults:[],queries:{},resolutionState:{}},{SEARCH_ERROR:Aa,SEARCH_REQUEST:Ta,SEARCH_SUCCESS:Oa,CHANGE_ACTION_STATUS:Na,INVALIDATE_RESOLUTION:Ca}=fa,{SEARCH_REQUEST:Da,SEARCH_SUCCESS:wa,SEARCH_ERROR:ba,CHANGE_ACTION_STATUS:Ha,INVALIDATE_RESOLUTION:La}=fa,Ua={updateSuggestions:(e,t)=>async({dispatch:r,registry:a})=>{const s="updateSuggestions";try{r.changeActionStatus(s,ue.Resolving),await a.batch(async()=>{r.searchRequest(e);const a=await(async(e,t={})=>{const{isInitialSuggestions:r=!1,type:a,subtype:s,page:o,perPage:i=(r?3:20)}=t,n=[],c=e=>!a||a===e||Array.isArray(a)&&a.indexOf(e)>=0,d=async(t,r)=>{try{return(await he(((e={search:""})=>Ie("wp/v2/search",e))({search:e,page:o,per_page:i,type:t,subtype:s}),{cache:"no-cache"})).map(e=>({...e,meta:{kind:r||t,subtype:s}}))}catch{return[]}};return c("post")&&n.push(d("post","post-type")),c("term")&&n.push(d("term","taxonomy")),c("post-format")&&n.push(d("post-format","taxonomy")),c("attachment")&&n.push(d("attachment","media")),(await Promise.all(n)).flat().filter(e=>!!e.id).slice(0,i).map(e=>{var t;const r="attachment"===e.type,a="object"==typeof e.title?null!==(t=e.title.rendered)&&void 0!==t?t:e.title.raw:e.title||(0,de.__)("(no title)","popup-maker");return{id:e.id,url:r&&e.source_url?e.source_url:e.url,title:a,type:e?.subtype||e.type,kind:e?.meta?.kind}})})(e,t);a&&(r.changeActionStatus(s,ue.Success),r.searchSuccess(e,a));const o=(0,de.__)("No results returned","popup-maker");r.changeActionStatus(s,ue.Error,o),r.searchError(e,o)})}catch(t){const a=me(t);r.changeActionStatus(s,ue.Error,a),r.searchError(e,a)}},searchRequest:e=>({type:Da,payload:{queryText:e}}),searchSuccess:(e,t)=>({type:wa,payload:{queryText:e,results:t}}),searchError:(e,t)=>({type:ba,payload:{queryText:e,error:t}}),changeActionStatus:(e,t,r)=>({dispatch:a})=>{r&&console.log(e,r),a({type:Ha,actionName:e,status:t,message:r})},invalidateResolution:e=>({dispatch:t})=>{t({type:La,payload:{id:e}})}},Pa={getSuggestions:(0,n.createSelector)(e=>e.searchResults||[],e=>[e.searchResults])},xa={getResolutionState:(0,n.createSelector)((e,t)=>{const r=e.resolutionState?.[t];return r||{status:ue.Idle}},(e,t)=>[t]),isIdle:(0,n.createSelector)((e,t)=>xa.getResolutionState(e,t).status===ue.Idle,(e,t)=>[t]),isResolving:(0,n.createSelector)((e,t)=>xa.getResolutionState(e,t).status===ue.Resolving,(e,t)=>[t]),hasResolved:(0,n.createSelector)((e,t)=>xa.getResolutionState(e,t).status===ue.Success,(e,t)=>[t]),hasFailed:(0,n.createSelector)((e,t)=>xa.getResolutionState(e,t).status===ue.Error,(e,t)=>[t]),getResolutionError:(0,n.createSelector)((e,t)=>xa.getResolutionState(e,t).error,(e,t)=>[t])},ka={...Pa,...xa},Va=(0,n.createReduxStore)(ma,{initialState:va,reducer:(e=va,t)=>{switch(t.type){case Ta:{const{queryText:r}=t.payload;return{...e,currentQuery:r}}case Oa:{const{queryText:r,results:a}=t.payload;return e.currentQuery===r?{...e,searchResults:a}:e}case Aa:{const{queryText:r,error:a}=t.payload;return e.currentQuery===r?{...e,error:a}:e}case Na:{const{actionName:r,status:a,message:s}=t;return{...e,resolutionState:{...e.resolutionState,[r]:{status:a,error:s}}}}case Ca:{const{id:r,operation:a}=t.payload;return{...e,resolutionState:{...e.resolutionState,[a]:{...e.resolutionState?.[a],[r]:void 0}}}}default:return e}},actions:Ua,selectors:ka}),Ga=window.wp.element,ja=()=>{var e,t,r,a;const{connectInfo:s,licenseKey:o,licenseStatus:i,isSaving:c,proWasActivated:d,isActivatingPro:l}=(0,n.useSelect)(e=>{const t=e(kt);return{connectInfo:t.getConnectInfo(),licenseKey:t.getLicenseKey(),licenseStatus:t.getLicenseStatus(),isSaving:t.isDispatching("activateLicense")||t.isDispatching("deactivateLicense")||t.isDispatching("checkLicenseStatus")||t.isDispatching("updateLicenseKey")||t.isDispatching("removeLicense"),isActivatingPro:t.isDispatching("activatePro"),proWasActivated:t.hasDispatched("activatePro")}},[]),{activateLicense:p,deactivateLicense:u,checkLicenseStatus:E,updateLicenseKey:y,removeLicense:S,activatePro:g}=(0,n.useDispatch)(kt),_="valid"===i?.license,h=["deactivated","site_inactive","inactive"].includes(null!==(e=i?.license)&&void 0!==e?e:""),R=["invalid","failed"].includes(i?.license),I=R&&["","missing"].includes(null!==(t=i?.error)&&void 0!==t?t:""),m="expired"===i?.license||["invalid","failed"].includes(null!==(r=i?.license)&&void 0!==r?r:"")&&"expired"===i?.error,f="disabled"===i?.license||R&&"disabled"===i?.error,v="no_activations_left"===i?.error,A=!!i?.error,T=R&&A&&!["missing","expired","disabled"].includes(null!==(a=i?.error)&&void 0!==a?a:""),O=(0,Ga.useMemo)(()=>_||h||m||f||v,[_,h,m,f,v]),N=(0,Ga.useMemo)(()=>_?"active":m?"expired":I?"missing":h?"deactivated":f?"disabled":T?"error":"unknown",[_,m,I,h,f,T]),C=(0,Ga.useMemo)(()=>{var e;let t=null!==(e=i?.price_id)&&void 0!==e?e:null;if(null===t)return-1;switch("string"==typeof t&&(t=parseInt(t,10)),t){default:return-1;case!1:case 0:return 0;case 1:case 2:case 3:case 4:return t}},[i?.price_id]);return{connectInfo:s,licenseKey:o,licenseStatus:i,licenseLevel:C,activateLicense:p,deactivateLicense:u,checkLicenseStatus:E,updateLicenseKey:y,removeLicense:S,activatePro:g,getLicenseStatusName:N,isSaving:c,isActivatingPro:l,proWasActivated:d,isLicenseKeyValid:O,isLicenseActive:_,isLicenseDeactivated:h,isLicenseMissing:I,isLicenseExpired:m,isLicenseInvalid:R,isLicenseDisabled:f,isLicenseOverQuota:v,isGeneralError:T,hasError:A}},Fa=()=>{const{currentSettings:e,unsavedChanges:t,hasUnsavedChanges:r,isSaving:a}=(0,n.useSelect)(e=>{const t=e(Ia);return{unsavedChanges:t.getUnsavedChanges(),hasUnsavedChanges:t.hasUnsavedChanges(),currentSettings:t.getSettings(),isSaving:t.isResolving("updateSettings")||t.isResolving("saveSettings")}},[]),{updateSettings:s,saveSettings:o,stageUnsavedChanges:i}=(0,n.useDispatch)(Ia),c=(0,Ga.useMemo)(()=>({...e,...t}),[e,t]);return{currentSettings:e,settings:c,getSetting:(e,t)=>{var r;return null!==(r=c[e])&&void 0!==r?r:t},updateSettings:s,saveSettings:o,isSaving:a,hasUnsavedChanges:r,stageUnsavedChanges:i,unsavedChanges:t}};(window.popupMaker=window.popupMaker||{}).coreData=t})();
(()=>{"use strict";var e={d:(o,t)=>{for(var r in t)e.o(t,r)&&!e.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:t[r]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};function t(e){var o,r,p="";if("string"==typeof e||"number"==typeof e)p+=e;else if("object"==typeof e)if(Array.isArray(e)){var n=e.length;for(o=0;o<n;o++)e[o]&&(r=t(e[o]))&&(p&&(p+=" "),p+=r)}else for(r in e)e[r]&&(p&&(p+=" "),p+=r);return p}e.r(o),e.d(o,{TriggerEdit:()=>M,name:()=>O,settings:()=>F});const r=function(){for(var e,o,r=0,p="",n=arguments.length;r<n;r++)(e=arguments[r])&&(o=t(e))&&(p&&(p+=" "),p+=o);return p},p=window.popupMaker.i18n,n=window.wp.hooks,i=window.wp.blockEditor,a=window.wp.components,s=window.wp.compose,l=window.popupMaker.components,c=window.popupMaker.icons,u=window.ReactJSXRuntime,{popupTriggerExcludedBlocks:d}=window.popupMakerBlockEditor,g=[],m=d||["core/nextpage","popup-maker/call-to-action","popup-maker/call-to-actions"];function k(e){return!g.length&&!m.length||(g.length?g.includes(e):!m.length||!m.includes(e))}const h=(0,s.createHigherOrderComponent)(e=>o=>{const{name:t,attributes:r,setAttributes:n,isSelected:s}=o,{openPopupId:d}=r;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(e,{...o}),s&&k(t)&&(0,u.jsx)(i.InspectorControls,{children:(0,u.jsx)(a.Panel,{className:"pum-block-inspector-popup-controls",children:(0,u.jsxs)(a.PanelBody,{title:(0,p.__)("Popup Controls","popup-maker"),icon:c.Mark,initialOpen:!1,children:[(0,u.jsx)(a.PanelRow,{children:(0,p.__)("These settings allow you to control popups with this block.","popup-maker")}),(0,u.jsx)(a.PanelRow,{children:(0,u.jsx)(l.PopupSelectControl,{label:(0,u.jsxs)(u.Fragment,{children:[(0,p.__)("Open Popup","popup-maker"),(0,u.jsx)(a.Tooltip,{placement:"top",text:(0,p.__)("This method does not work well with all block types.","popup-maker"),children:(0,u.jsx)("a",{href:"https://wppopupmaker.com/docs/triggering-popups/trigger-click-open-overview-methods/",target:"_blank",rel:"noopener noreferrer",children:(0,u.jsx)(a.Icon,{size:16,icon:"editor-help",title:(0,p.__)("Open documentation","popup-maker"),style:{verticalAlign:"middle"}})})})]}),value:d,onChange:e=>n({openPopupId:e}),help:(0,p.__)("Open a popup when clicking this block","popup-maker")})})]})})})]})},"withAdvancedControls");(0,n.addFilter)("blocks.registerBlockType","popup-maker/popup-trigger-attributes",function(e){return void 0!==e.attributes&&k(e.name)&&(e.attributes=Object.assign(e.attributes,{openPopupId:{type:"string",default:""}})),e}),(0,n.addFilter)("editor.BlockEdit","popup-maker/popup-trigger-advanced-control",h),(0,n.addFilter)("blocks.getSaveContent.extraProps","popup-maker/applyTriggerClass",function(e,o,t){const{openPopupId:p}=t;return void 0!==p&&p>0&&k(o.name)&&(e.className=r(e.className,"popmake-"+p)),e});const _=window.wp.richText,w=window.wp.a11y,b=window.wp.element,v=window.wp.data,f=window.wp.keycodes,x=({className:e,onChangeInputValue:o,value:t,...n})=>(0,u.jsx)("form",{className:r("block-editor-popup-trigger-popover__popup-editor",e),role:"dialog","aria-label":(0,p.__)("Popup Trigger Editor","popup-maker"),...n,children:(0,u.jsxs)("div",{className:"block-editor-popup-select-input",role:"group","aria-label":(0,p.__)("Popup Selection Controls","popup-maker"),children:[(0,u.jsx)(l.PopupSelectControl,{emptyValueLabel:(0,p.__)("Which popup should open?","popup-maker"),hideLabelFromVision:!0,value:String(t),onChange:o,required:!0}),(0,u.jsx)(a.Button,{icon:"editor-break",label:(0,p.__)("Apply","popup-maker"),type:"submit"})]})}),y=window.wp.htmlEntities,{popups:j=[]}=window.popupMakerBlockEditor;function S({popupId:e,className:o}){const t=r(o,"block-editor-popup-trigger-popover__popup-viewer-text"),n=((e=0)=>{e=parseInt(String(e))||0;const o=j.filter(({id:o})=>e===o);return 1===o.length&&o[0]})(e),i=n?/* translators: %s = popup title */ /* translators: %s = popup title */
(0,p.sprintf)((0,p.__)('Open "%s" popup',"popup-maker"),(0,y.decodeEntities)(n.title.rendered)):"";return(0,u.jsx)("span",{className:t,role:"button","aria-label":i,children:i})}function T({className:e="",spanClassName:o="",onEditTriggerClick:t,popupId:n,...i}){return(0,u.jsxs)("div",{className:r("block-editor-popup-trigger-popover__popup-viewer",e),role:"region","aria-label":(0,p.__)("Popup Trigger Preview","popup-maker"),...i,children:[(0,u.jsx)(S,{popupId:n,className:o}),t&&(0,u.jsx)(a.Button,{icon:"edit",label:(0,p.__)("Edit","popup-maker"),onClick:t})]})}function C(e,o,t,r,p){let n=o;const i={forwards:1,backwards:-1}[p]||1,a=-1*i;for(;e[n]&&e[n][r]===t;)n+=i;return n+=a,n}const E=(e,...o)=>(...t)=>e(...t,...o),P=(E(C,"backwards"),E(C,"forwards"),e=>e.stopPropagation()),I=e=>{[f.LEFT,f.DOWN,f.RIGHT,f.UP,f.BACKSPACE,f.ENTER].indexOf(parseInt(e.key))>-1&&e.stopPropagation()},N=({isActive:e,activeAttributes:o,value:t,onChange:r,onFocusOutside:n,stopAddingTrigger:s,contentRef:l,focusOnMount:c})=>{const{selectionChange:d}=(0,v.useDispatch)(i.store),{selectionStart:g}=(0,v.useSelect)(e=>{const{getSelectionStart:o}=e(i.store);return{selectionStart:o()}},[]),m=(0,b.useMemo)(()=>{return e=o,{popupId:parseInt(null!==(t=e.popupId)&&void 0!==t?t:"0"),doDefault:"1"===e.doDefault};var e,t},[o]),[k,h]=(0,b.useState)(!o||!o.popupId),f=(0,_.useAnchor)({editableContentElement:l.current,settings:{...F,isActive:e}}),y=(0,b.useCallback)(()=>{const e=(0,_.removeFormat)(t,O);r(e),s(),(0,w.speak)((0,p.__)("Trigger removed.","popup-maker"),"assertive")},[r,s,t]),[j,S]=(0,b.useState)(!1),C=(0,b.useCallback)(()=>{S(e=>!e)},[]),E=(0,b.useCallback)(o=>{const n=m?.popupId,i=!n,a={...m,...o};if(!i&&!a?.popupId)return void y();const s=(({popupId:e=0,doDefault:o=!1})=>({type:O,attributes:{class:`popmake-${e} ${o?"pum-do-default":""}`,popupId:e.toString(),doDefault:o?"1":"0"}}))(a),l=(0,p.__)("Open Popup","popup-maker");let c;(0,_.isCollapsed)(t)&&!e?(c=function(e,o,t,r){const p=(0,_.insert)(e,o,r);return(0,_.applyFormat)(p,t,r,r+o.length)}(t,l,s,t.start),r(c),d({clientId:g.clientId,identifier:g.attributeKey,start:t.start+l.length+1})):(c=(0,_.applyFormat)(t,s),r(c)),e?(0,w.speak)((0,p.__)("Trigger edited.","popup-maker"),"assertive"):(0,w.speak)((0,p.__)("Trigger inserted.","popup-maker"),"assertive")},[m,t,e,r,y,d,g]),N=k||!m.popupId,{popupId:A,doDefault:M}=m,D=(0,b.useRef)(null);return(0,b.useEffect)(()=>{const o=l.current;D.current=e&&o?.ownerDocument?.activeElement!==o?.ownerDocument?.body?o?.ownerDocument?.activeElement:o;const t=e=>{"Escape"===e.key&&s()};return document.addEventListener("keydown",t),()=>{D.current&&"focus"in D.current&&D.current.focus(),document.removeEventListener("keydown",t)}},[l,e,s]),(0,b.useEffect)(()=>()=>{},[]),(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(a.Popover,{className:"block-editor-popup-trigger__inline-popover  editor-popup-trigger-popover block-editor-popup-trigger-popover",anchor:f,animate:!1,onClose:()=>{e||s()},onFocusOutside:n,position:"bottom center",offset:8,shift:!0,focusOnMount:c,constrainTabbing:!0,children:(0,u.jsxs)("div",{className:"block-editor-popup-trigger-popover__input-container",children:[(0,u.jsxs)("div",{className:"editor-popup-trigger-popover__row block-editor-popup-trigger-popover__row",children:[N?(0,u.jsx)(x,{className:"editor-format-toolbar__trigger-container-content block-editor-format-toolbar__trigger-container-content",value:null!=A?A:"",onChangeInputValue:e=>{E({popupId:Number(e)})},onKeyDown:I,onKeyPress:P,onSubmit:s}):(0,u.jsx)(T,{className:"editor-format-toolbar__trigger-container-content block-editor-format-toolbar__trigger-container-content",onKeyPress:P,popupId:null!=A?A:0,onEditTriggerClick:e=>{h(!0),e.preventDefault()}}),(0,u.jsx)(a.Button,{className:"editor-popup-trigger-popover__settings-toggle block-editor-popup-trigger-popover__settings-toggle",icon:j?"arrow-up-alt2":"arrow-down-alt2",label:(0,p.__)("Trigger settings","popup-maker"),onClick:C,"aria-expanded":j})]}),j&&(0,u.jsx)("div",{className:"editor-popup-trigger-popover__row block-editor-popup-trigger-popover__row editor-popup-trigger-popover__settings block-editor-popup-trigger-popover__settings",children:(0,u.jsx)(a.ToggleControl,{label:(0,p.__)("Do not prevent default click behavior","popup-maker"),checked:!!M,onChange:e=>E({doDefault:e}),__nextHasNoMarginBottom:!0})})]})})})},A=(0,p.__)("Popup Trigger","popup-maker"),O="popup-maker/popup-trigger",M=(0,a.withSpokenMessages)(({isActive:e,activeAttributes:o,value:t,onChange:r,onFocus:n,contentRef:a})=>{const[s,l]=(0,b.useState)(!1),[d,g]=(0,b.useState)(null);(0,b.useEffect)(()=>{e||l(!1)},[e]),(0,b.useLayoutEffect)(()=>{const o=a?.current;if(o)return o.addEventListener("click",t),()=>{o.removeEventListener("click",t)};function t(o){const t=o.target,r=t?.closest("[contenteditable] span.popup-trigger");r&&e&&(l(!0),g({el:r,action:"click"}))}},[a,e]);const m=()=>{l(!0)},k=()=>{r((0,_.removeFormat)(t,O)),(0,w.speak)((0,p.__)("Trigger removed.","popup-maker"),"assertive")},h=!("SPAN"===d?.el?.tagName&&"click"===d?.action),v=!(0,_.isCollapsed)(t);return(0,u.jsxs)(u.Fragment,{children:[v&&(0,u.jsx)(i.RichTextShortcut,{type:"primary",character:"p",onUse:m}),(0,u.jsx)(i.RichTextShortcut,{type:"primaryShift",character:"p",onUse:k}),e?(0,u.jsx)(i.RichTextToolbarButton,{icon:c.MarkWhite,iconSize:16,title:(0,p.__)("Remove Trigger","popup-maker"),onClick:k,isActive:e,shortcutType:"primaryShift",shortcutCharacter:"p","aria-haspopup":"true","aria-expanded":s}):(0,u.jsx)(i.RichTextToolbarButton,{icon:c.Mark,iconSize:16,title:A,onClick:m,isActive:e,shortcutType:"primary",shortcutCharacter:"p","aria-haspopup":"true","aria-expanded":s}),s&&(0,u.jsx)(N,{stopAddingTrigger:()=>{l(!1),d?.el?d.el.focus():n(),g(null)},onFocusOutside:()=>{l(!1),g(null)},isActive:e,activeAttributes:o,value:t,onChange:r,contentRef:a,focusOnMount:!!h&&"firstElement"})]})}),F={name:O,title:A,tagName:"span",className:"popup-trigger",object:!1,attributes:{popupId:"data-popup-id",doDefault:"data-do-default"},interactive:!1,edit:M};[o].forEach(({name:e,settings:o})=>(0,_.registerFormatType)(e,o));const D=window.popupMaker.coreData;(0,v.register)(D.callToActionStore),(0,v.register)(D.licenseStore),(0,v.register)(D.settingsStore),(0,v.register)(D.popupStore),(0,v.register)(D.urlSearchStore),(window.popupMaker=window.popupMaker||{}).blockEditor={}})();